# Домашняя работа на тему: Шардирование. Принципы работы
## Материалы по теме
- [Лекция](https://otus.ru/learning/38460/#/)
- [Теория шардирования](https://habr.com/ru/company/oleg-bunin/blog/433370/)
## 1. Введение
В настоящей работе рассматриваются варианты использования шардирования применительно к разрабатываемому в рамках курса приложению автоматизации складского предприятия
## 1. Выбор данных для шардирования
Предположим, что складское предприятие ведёт свой бизнес в нескольких различных города, и в каждом городе может быть несколько площадок (самостоятельных складов). Один и тоже клиент предприятия может пользоваться услугами предприятия в разных городах. Следует отметить, что клиент самостоятельно решает к какому подразделению (площадке) следует обратиться для получения/передачи своего товара. Иными словами, предприятие не оказывает услуг по сбору товаров клиента по различным площадкам  для отгрузки в одном месте.

На мой взгляд, основной ресурсоёмкой операцией является поиск местонахождения товара в системе адресных хранилищ предприятия. Т. е. поиск ответа на вопрос: где лежит такой-то товар? Знать ответ на подобный вопрос важно по следующим причинам:
- необходимо найти товар, чтобы его можно выдать клиенту
- определить место куда можно положить товар. Если есть место, то товар можно положить в хранилище, содержащее точно такой же товар (это минимизирует количество действий кладовщиков при подборе товара)

На первый взгляд может показаться, что достаточно реализовать шардирование по географическому принципу: для каждой площадки установить свой экземпляр базы данных, и по коду площадки, указанному в заявке клиента, осуществлять необходимое перенаправление (на стороне сервера) запроса.  Но есть один момент, бизнес-деятельность в Москве по объёмам значительно превосходит бизнес-деятельность в другом, менее крупном городе. Таким образом получается, что шарды будут загружены неравномерно, и как я считаю, отличие будет на порядки. Таким образом, необходимо провести ещё и шардирование данных о размещения товаров (адресное хранение) в рамках высоконагруженных площадок. Шардирование можно будет проводить последовательно, начиная с базы данных высоконагруженых площадок или площадок по которым ожидается большая нагрузка. Базы данных остальных площадок можно шардировать в процессе работы, по мере роста нагрузки.

Таким образом, шардирование должно осуществляться по географическому принципу и  для высоконагруженных площадок должно осуществляться шардирование данных о размещении товаров в рамках площадок предприятия.

Дополнительно, имеет смысл рассмотреть возможность шардирования данных о движении товаров (какой товар и когда был помещён или забран из конкретной единицы хранилища)
## 2. Критерий шардирования
Предлагается, в качестве критерия шардирования данных о местоположении хранения товаров, использовать штрих-код товара. Штрих-код товара представляет собой текстовую строку, будь-то EAN13 или CODE39. Для текстовой строки достаточно просто получить хеш и он будет распределён достаточно равномерно, как и для произвольных строк. При этом описания мест хранения для конкретного товара будут находится в одной шарде. Т.е. поиск ограничится одной шардой. А если ещё в качестве первичного ключа шардируемой таблицы использовать составной ключ (код места хранения, штрих-код), то поиск мест хранения по штрих-коду будет очень быстрым. Номер шарды, в предлагаемом варианте реализации, определяется по формуле, описанной на лекции (остаток от деления на количество шард).

Добавление новой шарды не представляет особых трудностей, но потребует значительных временных затрат. Придётся последовательно пересчитать номер шарды для всех записей, и если необходимо, произвести перенос записей между шардами. По крайней мере, этот процесс может быть автоматизирован.


